# HTML-Only Cockpit System Guide

**Status:** ✅ Operational  
**Mode:** File-based, local-first, read-only cockpit  
**No dependencies:** No backend, no API, no frameworks required

---

## Overview

The HTML-only cockpit is a **passive observer** of the agent orchestration system. It reads state files generated by agents and Python scripts, displays system status, and provides a human-readable interface for reviewing agent progress and pending approvals.

### Core Principles

- **Read-only by default** - HTML never writes to files
- **File-driven** - All state comes from JSON files on disk
- **Manual refresh** - User clicks "Load State File" or refreshes browser
- **Zero infrastructure** - Opens directly in browser, no server required
- **Agent-independent** - Agents operate normally even if HTML is never opened

---

## Quick Start

### 1. Generate State Snapshot

**Windows (Easiest):**
- Double-click: `dashboards/generate_snapshot.bat`
- Or use PowerShell:
  ```powershell
  cd agent-orchestrator
  py scripts\cockpit__generate__state_snapshot.py
  ```

**Linux/Mac:**
```bash
cd agent-orchestrator
python scripts/cockpit__generate__state_snapshot.py
```

**Note for Windows Users:**
- If `python` command is not recognized, use `py` instead (Windows Python launcher)
- The batch file (`generate_snapshot.bat`) automatically tries multiple methods:
  1. `py` launcher (recommended)
  2. `python` command
  3. Virtual environment Python (`.venv\Scripts\python.exe`)

This generates: `dashboards/cockpit_state.out.json`

### 2. Open HTML Cockpit

Open `dashboards/cockpit_template.html` in your browser (double-click or `file://` URL).

### 3. Load State File

Click "Load State File" button and select `cockpit_state.out.json`.

---

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    AGENTS (Python Scripts)                   │
│  - Write artifacts to artifacts/{agent_id}/                 │
│  - Update registry/agent-registry.json                      │
│  - Log to audit/audit-log.jsonl                             │
│  - Create review queues in review/{gate}_queue.json         │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      │ Agents write files independently
                      │
┌─────────────────────▼───────────────────────────────────────┐
│              STATE SNAPSHOT GENERATOR                        │
│  scripts/cockpit__generate__state_snapshot.py               │
│  - Reads all JSON files                                      │
│  - Aggregates into single snapshot                          │
│  - Writes: dashboards/cockpit_state.out.json                │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      │ Generated snapshot file
                      │
┌─────────────────────▼───────────────────────────────────────┐
│                  HTML COCKPIT (Read-Only)                    │
│  dashboards/cockpit_template.html                           │
│  - File picker loads snapshot JSON                          │
│  - Displays: agents, reviews, alerts, state                │
│  - No write operations                                      │
│  - Manual refresh or file reload                            │
└─────────────────────────────────────────────────────────────┘
```

---

## State Snapshot Schema

The snapshot generator creates a JSON file with this structure:

```json
{
  "_meta": {
    "generated_at": "2026-01-20T12:00:00Z",
    "source": "file_based",
    "schema_version": "1.0.0",
    "files_read": {
      "registry": "registry/agent-registry.json",
      "state": "state/legislative-state.json",
      "review_dir": "review",
      "audit_log": "audit/audit-log.jsonl"
    }
  },
  "timestamp": "2026-01-20T12:00:00Z",
  "system": {
    "status": "active",
    "current_state": "PRE_EVT",
    "state_definition": "Pre-Event Intelligence",
    "state_lock": false,
    "next_allowed_states": ["INTRO_EVT"],
    "state_advancement_rule": "Requires HR_PRE approval",
    "agents": {
      "running": 2,
      "waiting_review": 1,
      "idle": 10,
      "retired": 8,
      "blocked": 0,
      "total": 20
    }
  },
  "legislative": {
    "current_state": "PRE_EVT",
    "state_definition": "Pre-Event Intelligence",
    "state_lock": false,
    "state_history": [...],
    "next_allowed_states": ["INTRO_EVT"],
    "state_advancement_rule": "Requires HR_PRE approval"
  },
  "agents": {
    "_meta": {
      "total_agents": 20,
      "active_agents": 2,
      "idle_agents": 10,
      "waiting_review_agents": 1,
      "blocked_agents": 0,
      "retired_agents": 8
    },
    "agents": [
      {
        "agent_id": "draft_concept_memo_pre_evt",
        "agent_type": "Drafting",
        "status": "WAITING_REVIEW",
        "scope": "Generate PRE_CONCEPT artifact",
        "current_task": "Waiting for HR_PRE review",
        "last_heartbeat": "2026-01-20T12:00:00Z",
        "risk_level": "MEDIUM",
        "outputs": ["artifacts/draft_concept_memo_pre_evt/PRE_CONCEPT.json"]
      }
    ]
  },
  "reviews": [
    {
      "review_id": "review-1",
      "artifact_name": "PRE_CONCEPT",
      "artifact_path": "artifacts/draft_concept_memo_pre_evt/PRE_CONCEPT.json",
      "gate_id": "HR_PRE",
      "gate_name": "Approve Concept Direction",
      "submitted_at": "2026-01-20T12:00:00Z",
      "submitted_by": "draft_concept_memo_pre_evt",
      "review_effort_estimate": "10-90 minutes",
      "risk_level": "Low-Medium"
    }
  ],
  "review_gates": [
    {
      "gate_id": "HR_PRE",
      "gate_name": "Approve Concept Direction",
      "status": "PENDING",
      "artifact_name": "PRE_CONCEPT",
      "artifact_path": "artifacts/draft_concept_memo_pre_evt/PRE_CONCEPT.json",
      "risk_level": "Low-Medium"
    }
  ],
  "alerts": [
    {
      "level": "warning",
      "message": "Agent draft_concept_memo_pre_evt awaiting review",
      "timestamp": "2026-01-20T12:00:00Z",
      "agent_id": "draft_concept_memo_pre_evt",
      "review_gate": "HR_PRE"
    }
  ],
  "recent_activity": [
    {
      "timestamp": "2026-01-20T12:00:00Z",
      "event_type": "agent_spawned",
      "agent_id": "draft_concept_memo_pre_evt",
      "message": "Agent spawned"
    }
  ]
}
```

---

## File-Based State Contract

### Required Files (Generated by Agents)

| File | Source | Purpose |
|------|--------|---------|
| `registry/agent-registry.json` | Agents register themselves | Agent status, heartbeats, outputs |
| `state/legislative-state.json` | Orchestrator/StateManager | Current legislative state, history |
| `review/{gate_id}_queue.json` | ReviewSync/Agents | Pending reviews, approval status |
| `audit/audit-log.jsonl` | All agents | Event log (append-only) |
| `artifacts/{agent_id}/{artifact_type}.json` | Individual agents | Agent outputs |

### Generated File (For HTML Consumption)

| File | Source | Purpose |
|------|--------|---------|
| `dashboards/cockpit_state.out.json` | `cockpit__generate__state_snapshot.py` | Aggregated snapshot for HTML |

---

## Update Model

### How State Updates

1. **Agents write files** - Agents update registry, create artifacts, log events
2. **Snapshot generator reads files** - Script aggregates all file-based state
3. **HTML reads snapshot** - User manually loads snapshot JSON file
4. **Manual refresh** - User reloads file or regenerates snapshot

### No Real-Time Updates

- No WebSocket connections
- No server-sent events
- No automatic polling
- No push mechanisms

**State updates require:**
- Running snapshot generator script
- Manual file reload in HTML

---

## Human Review Workflow

### Review Flow (No UI Commands)

1. **Agent generates artifact** → Status: `WAITING_REVIEW`
2. **Review queue file updated** → `review/{gate_id}_queue.json`
3. **Human reviews in HTML** → Reads snapshot, sees pending reviews
4. **Human approves via CLI** → `python scripts/cockpit__approve_artifact.py HR_PRE artifact_id APPROVE`
5. **Review queue file updated** → Status changes to `APPROVED`
6. **Orchestrator checks file** → Reads approval from file, unblocks progress

**HTML never sends commands to agents.** Human actions occur outside HTML via CLI scripts.

---

## Failure Modes

### What Happens If HTML Is Never Opened?

✅ **System continues normally:**
- Agents keep running
- Files keep updating
- Review gates keep blocking
- Human can approve via CLI scripts

❌ **Only missing:** Visual dashboard

### What Happens If Snapshot Generator Fails?

✅ **System continues normally:**
- Agents unaffected
- Files still written
- Human can review files directly

❌ **Missing:** Aggregated snapshot for HTML

### What Happens If State Files Are Missing?

✅ **Snapshot generator handles gracefully:**
- Missing files return `{}`
- Generator continues with available data
- HTML shows "No data" for missing sections

---

## Usage Patterns

### Pattern 1: Regular Monitoring

**Windows:**
```powershell
# Generate snapshot (choose one method)
# Option 1: Use batch file (easiest)
.\dashboards\generate_snapshot.bat

# Option 2: Use py launcher
py scripts\cockpit__generate__state_snapshot.py

# Option 3: Use venv Python directly
.venv\Scripts\python.exe scripts\cockpit__generate__state_snapshot.py

# Open HTML (manually or via script)
# Load cockpit_state.out.json

# Review status, pending reviews, alerts

# If approvals needed:
py scripts\cockpit__approve_artifact.py HR_PRE artifact_id APPROVE

# Regenerate snapshot to see updates
py scripts\cockpit__generate__state_snapshot.py
```

**Linux/Mac:**
```bash
# Generate snapshot
python scripts/cockpit__generate__state_snapshot.py

# Open HTML (manually or via script)
# Load cockpit_state.out.json

# Review status, pending reviews, alerts

# If approvals needed:
python scripts/cockpit__approve_artifact.py HR_PRE artifact_id APPROVE

# Regenerate snapshot to see updates
python scripts/cockpit__generate__state_snapshot.py
```

### Pattern 2: Continuous Workflow

**Windows:**
```powershell
# Terminal 1: Run agents (they write files)
py orchestrate_intro_evt.py

# Terminal 2: Periodically generate snapshots (PowerShell loop)
while ($true) {
    py scripts\cockpit__generate__state_snapshot.py
    Start-Sleep -Seconds 60
}

# Browser: Keep HTML open, reload snapshot file periodically
```

**Linux/Mac:**
```bash
# Terminal 1: Run agents (they write files)
python orchestrate_intro_evt.py

# Terminal 2: Periodically generate snapshots
watch -n 60 python scripts/cockpit__generate__state_snapshot.py

# Browser: Keep HTML open, reload snapshot file periodically
```

### Pattern 3: Review-Only Session

**Windows:**
```powershell
# Generate snapshot
py scripts\cockpit__generate__state_snapshot.py

# Open HTML
# Review all pending items
# Make approval decisions

# Execute approvals:
py scripts\cockpit__approve_artifact.py HR_PRE artifact1 APPROVE
py scripts\cockpit__approve_artifact.py HR_PRE artifact2 REJECT

# Regenerate to verify
py scripts\cockpit__generate__state_snapshot.py
```

**Linux/Mac:**
```bash
# Generate snapshot
python scripts/cockpit__generate__state_snapshot.py

# Open HTML
# Review all pending items
# Make approval decisions

# Execute approvals:
python scripts/cockpit__approve_artifact.py HR_PRE artifact1 APPROVE
python scripts/cockpit__approve_artifact.py HR_PRE artifact2 REJECT

# Regenerate to verify
python scripts/cockpit__generate__state_snapshot.py
```

---

## Customization

### Customizing the Snapshot Generator

Edit `scripts/cockpit__generate__state_snapshot.py` to:
- Add additional data sources
- Customize alert generation logic
- Include additional metadata

### Customizing the HTML Cockpit

Edit `dashboards/cockpit_template.html` to:
- Change styling (CSS in `<style>` tag)
- Add additional views/sections
- Modify rendering logic (JavaScript at bottom)

**Note:** Keep HTML-only constraints:
- No frameworks
- No build step
- No backend dependencies
- Works with `file://` protocol

---

## Compliance Checklist

✅ **HTML-only rules:**
- [x] No React, Vue, Next.js, or frameworks
- [x] No backend services
- [x] No databases
- [x] No authentication
- [x] No cloud deployment assumptions
- [x] Opens directly in browser (`file://`)
- [x] File picker for loading state
- [x] Progressive enhancement (works without JS for core content)

✅ **Agent orchestration compatibility:**
- [x] Agents operate independently
- [x] State is file-driven
- [x] HTML is passive observer
- [x] Human review via CLI (not UI)
- [x] No cloud or usage-based services

---

## Troubleshooting

### Python Command Not Recognized (Windows)

**Symptom:** `python : The term 'python' is not recognized`

**Solutions:**
1. **Use `py` launcher (recommended):**
   ```powershell
   py scripts\cockpit__generate__state_snapshot.py
   ```

2. **Use virtual environment Python directly:**
   ```powershell
   .venv\Scripts\python.exe scripts\cockpit__generate__state_snapshot.py
   ```

3. **Use the batch file:**
   ```powershell
   .\dashboards\generate_snapshot.bat
   ```

**Why this happens:** Windows PowerShell may not have `python` in PATH, even with virtual environment activated. The `py` launcher is the standard Windows Python installation method.

### Snapshot Generator Shows "No Data"

**Check:**
- Registry file exists: `registry/agent-registry.json`
- State file exists: `state/legislative-state.json`
- Review directory exists: `review/`
- Files are valid JSON

**Fix:**
- Run agents to generate files
- Check file permissions
- Verify JSON syntax

### HTML Doesn't Load Snapshot

**Check:**
- File path is correct
- File is valid JSON
- Browser console for errors

**Fix:**
- Regenerate snapshot
- Check JSON syntax:
  - **Windows:** `py -m json.tool cockpit_state.out.json`
  - **Linux/Mac:** `python -m json.tool cockpit_state.out.json`
- Try different browser

### Missing Reviews in HTML

**Check:**
- Review queue files exist: `review/*_queue.json`
- Files have `pending_reviews` array
- Snapshot generator ran after review files updated

**Fix:**
- Regenerate snapshot
- Check review queue file structure
- Verify agents are creating review entries

---

## Related Files

- **Snapshot Generator:** `scripts/cockpit__generate__state_snapshot.py`
- **Windows Batch File:** `dashboards/generate_snapshot.bat` (Windows convenience script)
- **HTML Template:** `dashboards/cockpit_template.html`
- **Approval Scripts:** `scripts/cockpit__approve_artifact.py`, `scripts/cockpit__advance_state.py`
- **State Loaders:** `monitoring/loaders.py` (reference implementation)
- **Rules:** `.cursor/rules/html_only_local_first_rules.mdc`

---

**Last Updated:** 2026-01-20  
**Schema Version:** 1.0.0

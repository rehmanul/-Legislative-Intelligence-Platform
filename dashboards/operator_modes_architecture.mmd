%% Operator Modes System Architecture Diagram
%% Frontend Perspective with Color Semantics
%% Version: 2.0.0
%% Last Updated: 2026-01-20

%%{init: {
  'theme':'base',
  'themeVariables': {
    'primaryColor':'#e8f5e9',
    'primaryTextColor':'#2e7d32',
    'primaryBorderColor':'#4caf50',
    'lineColor':'#81c784',
    'secondaryColor':'#fff3e0',
    'tertiaryColor':'#e3f2fd',
    'errorBkgColor':'#ffebee',
    'errorTextColor':'#c62828',
    'warningBkgColor':'#fff9c4',
    'warningTextColor':'#f57f17'
  }
}}%%

flowchart TB
    subgraph Operator_UI["ğŸ›ï¸ Operator Dashboard - Control Interface"]
        direction TB
        
        StatusBanner["SystemStatusBanner<br/>ğŸŸ¡ YELLOW Status<br/>ğŸ“ 2 pending reviews<br/>â° Last update: 2m ago<br/>ğŸ“ State: INTRO_EVT"]
        
        ModeNav["OperatorModeNav<br/>ğŸ“Š Overview | ğŸ”¥ Heat Map | âœˆï¸ Cockpit âš ï¸ | âš¡ Velocity | ğŸ“ Diagram"]
        
        subgraph Overview_Mode["ğŸ“Š Overview Mode (Read-Only ğŸŸ¢)"]
            Overview_Content["Summary Cards<br/>â€¢ System Status: YELLOW<br/>â€¢ Pending: 2 reviews<br/>â€¢ Active Agents: 3<br/>â€¢ Last Update: 2m ago"]
        end
        
        subgraph HeatMap_Mode["ğŸ”¥ Heat Map Mode (Read-Only ğŸŸ¢)"]
            HeatMap_Viz["HeatMapVisualization<br/>ğŸ“Š Agent Status Distribution<br/>ğŸ“‹ Review Gate Status<br/>ğŸš« Blocking Conditions<br/>âœ… State Advancement Readiness"]
        end
        
        subgraph Cockpit_Mode["âœˆï¸ Cockpit Mode (Write-Enabled ğŸ”´) âš ï¸"]
            Cockpit_Actions["CockpitActionPanel<br/>ğŸ“ Pending Approvals: 2<br/>ğŸš€ State Advancement<br/>ğŸ”“ Execution Authorization<br/>âš ï¸ All actions require confirmation"]
            Action_Modal["ActionConfirmationModal<br/>âš ï¸ Confirmation Required<br/>ğŸ“‹ Audit Trail Preview<br/>ğŸ”’ Irreversible Warning<br/>âœ… Confirm | âŒ Cancel"]
        end
        
        subgraph Velocity_Mode["âš¡ Velocity Mode (Read-Only ğŸŸ¢)"]
            Velocity_Metrics["VelocityMetricsPanel<br/>ğŸ“ˆ Throughput: 5 artifacts/hr<br/>â±ï¸ Review Cycle: 2.5h avg<br/>âš ï¸ Bottleneck: HR_PRE<br/>ğŸ“Š Trend: â†‘ Improving"]
        end
        
        subgraph Diagram_Mode["ğŸ“ System Diagram Mode (Read-Only ğŸŸ¢)"]
            Arch_Graph["ArchitectureGraph<br/>ğŸ¨ Color-Coded Nodes<br/>ğŸŸ¢ Green: Read-Only<br/>ğŸŸ  Orange: Display<br/>ğŸ”´ Red: Actions<br/>ğŸŸ¡ Yellow: Status"]
            Node_Inspector["NodeInspectorPanel<br/>ğŸ“‹ Node Details<br/>ğŸ”— View in Cockpit Link<br/>ğŸ“Š Metrics Display"]
        end
    end
    
    subgraph Monitoring["ğŸŸ¢ Read-Only Monitoring (Green Zone)"]
        direction TB
        MetricsStore["Metrics Store<br/>ğŸ“Š Agent State<br/>ğŸ“ˆ System Metrics<br/>â° Timestamped"]
        Logs["Logs Viewer<br/>ğŸ“ Audit Log<br/>ğŸ“‹ Event Stream<br/>ğŸ” Searchable"]
        AgentState["Agent State Display<br/>ğŸ“‹ Registry Data<br/>ğŸ“Š Status Distribution<br/>ğŸ”„ Auto-refresh"]
    end
    
    subgraph Display["ğŸŸ  Display Scripts (Orange Zone)"]
        direction TB
        QueueViewer["Queue Viewer<br/>ğŸ“‹ Pending Reviews<br/>ğŸšª Review Gates<br/>ğŸ“Š Queue Status"]
        ReviewTable["Review Table<br/>âœ… Approval History<br/>ğŸ“ Decision Log<br/>â° Timestamps"]
        Timeline["Timeline<br/>ğŸ“… State History<br/>ğŸ“‹ Event Timeline<br/>ğŸ” Filterable"]
    end
    
    subgraph Actions["ğŸ”´ Action Scripts (Red Zone) âš ï¸"]
        direction TB
        Approvals["Approvals<br/>âœ… APPROVE<br/>âŒ REJECT<br/>ğŸ”„ Reversible"]
        StateAdvance["State Advancement<br/>ğŸš€ ADVANCE STATE<br/>âš ï¸ IRREVERSIBLE<br/>ğŸ”’ High Risk"]
        KillSwitch["Kill Switch<br/>ğŸ›‘ EMERGENCY STOP<br/>âš ï¸ CRITICAL<br/>ğŸš¨ Immediate"]
        ExecAuth["Execution Auth<br/>ğŸ”“ AUTHORIZE<br/>âš ï¸ HIGH RISK<br/>ğŸ“‹ Plan Required"]
    end
    
    subgraph Status["ğŸŸ¡ System Status (Yellow Zone)"]
        direction TB
        HealthCheck["Health Check<br/>ğŸ’š System Health<br/>ğŸ“Š Status Aggregation<br/>ğŸ”„ Continuous"]
        AlertEngine["Alert Engine<br/>ğŸš¨ Alert Aggregation<br/>ğŸ“ˆ Escalation<br/>â° Real-time"]
    end
    
    subgraph Data_Sources["ğŸ“‚ Canonical Data Sources"]
        direction TB
        Registry["agent-registry.json<br/>ğŸ¤– 12 agents<br/>ğŸŸ¢ 1 RUNNING<br/>ğŸŸ¡ 1 WAITING_REVIEW<br/>ğŸ”´ 1 BLOCKED"]
        State["legislative-state.json<br/>ğŸ“ Current: INTRO_EVT<br/>â¡ï¸ Next: COMM_EVT<br/>â±ï¸ Time: 8h 58m"]
        Reviews["review/*_queue.json<br/>ğŸ” HR_PRE: 2 pending<br/>âœ… HR_LANG: 0<br/>âœ… HR_MSG: 0"]
        Audit["audit-log.jsonl<br/>ğŸ“ All actions logged<br/>ğŸ” Event tracking<br/>â° Timestamped"]
    end
    
    %% Data Flow (Read-Only)
    Data_Sources -.->|"Read"| Monitoring
    Data_Sources -.->|"Read"| Display
    Data_Sources -.->|"Read"| Status
    
    %% UI Connections
    StatusBanner --> ModeNav
    ModeNav --> Overview_Mode
    ModeNav --> HeatMap_Mode
    ModeNav --> Cockpit_Mode
    ModeNav --> Velocity_Mode
    ModeNav --> Diagram_Mode
    
    %% Monitoring to UI (Read-Only)
    Monitoring -.->|"Display"| Overview_Mode
    Monitoring -.->|"Display"| HeatMap_Mode
    Monitoring -.->|"Display"| Velocity_Mode
    Monitoring -.->|"Display"| Diagram_Mode
    
    %% Display to UI (Read-Only, Actionable Links)
    Display -.->|"Display"| HeatMap_Mode
    Display -.->|"Link to Cockpit"| Cockpit_Mode
    Display -.->|"Display"| Diagram_Mode
    
    %% Actions to Cockpit (Write Flow)
    Cockpit_Mode -->|"Triggers"| Action_Modal
    Action_Modal -->|"Confirms"| Actions
    Actions -->|"Writes"| Data_Sources
    
    %% Status to UI
    Status -->|"Updates"| StatusBanner
    Status -->|"Displays"| Overview_Mode
    
    %% Diagram Interactions (Read-Only)
    Arch_Graph -->|"Click"| Node_Inspector
    Node_Inspector -.->|"Navigate"| Cockpit_Mode
    
    %% Trust Boundaries
    Monitoring -.->|"ğŸŸ¢ Read-Only"| Overview_Mode
    Monitoring -.->|"ğŸŸ¢ Read-Only"| HeatMap_Mode
    Monitoring -.->|"ğŸŸ¢ Read-Only"| Velocity_Mode
    Monitoring -.->|"ğŸŸ¢ Read-Only"| Diagram_Mode
    
    Display -.->|"ğŸŸ  Display Only"| HeatMap_Mode
    Display -.->|"ğŸŸ  Link to Action"| Cockpit_Mode
    
    Actions -->|"ğŸ”´ Write-Enabled"| Cockpit_Mode
    Cockpit_Mode -->|"ğŸ”´ Requires Confirmation"| Action_Modal
    
    %% Styling
    classDef readOnly fill:#e8f5e9,stroke:#4caf50,stroke-width:2px,color:#2e7d32
    classDef display fill:#fff3e0,stroke:#ff9800,stroke-width:2px,color:#e65100
    classDef action fill:#ffebee,stroke:#c62828,stroke-width:3px,color:#b71c1c
    classDef status fill:#fff9c4,stroke:#f57f17,stroke-width:2px,color:#e65100
    classDef data fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,color:#0d47a1
    classDef ui fill:#f5f5f5,stroke:#9e9e9e,stroke-width:2px,color:#424242
    
    class Monitoring,MetricsStore,Logs,AgentState,Overview_Mode,HeatMap_Mode,Velocity_Mode,Diagram_Mode,Arch_Graph,Node_Inspector,HeatMap_Viz,Velocity_Metrics,Overview_Content readOnly
    class Display,QueueViewer,ReviewTable,Timeline display
    class Actions,Approvals,StateAdvance,KillSwitch,ExecAuth,Cockpit_Mode,Cockpit_Actions,Action_Modal action
    class Status,HealthCheck,AlertEngine,StatusBanner status
    class Data_Sources,Registry,State,Reviews,Audit data
    class Operator_UI,ModeNav ui

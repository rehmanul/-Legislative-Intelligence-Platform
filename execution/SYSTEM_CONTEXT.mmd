%% Master Diagram Reference: .userInput/agent orchestrator 1.6.mmd
%% This diagram is a specialized view derived from the master diagram
flowchart TB
    subgraph OrchestratorCore["üéØ Agent Orchestrator Core System"]
        FastAPI[FastAPI State Machine<br/>Workflow Management]
        StateMachine[Legislative State Machine<br/>PRE_EVT ‚Üí INTRO_EVT ‚Üí COMM_EVT<br/>‚Üí FLOOR_EVT ‚Üí FINAL_EVT ‚Üí IMPL_EVT]
        ReviewGates[Review Gates<br/>HR_PRE, HR_LANG, HR_MSG, HR_RELEASE]
    end
    
    subgraph IntelligenceLayer["üìä Intelligence Layer"]
        SignalScan[Signal Scanning Agents<br/>PRE_EVT, INTRO_EVT]
        StakeholderMap[Stakeholder Mapping<br/>PRE_EVT, INTRO_EVT, COMM_EVT]
        OppositionDetect[Opposition Detection<br/>PRE_EVT, INTRO_EVT]
    end
    
    subgraph DraftingLayer["‚úçÔ∏è Drafting Layer"]
        ConceptMemo[Concept Memos<br/>PRE_EVT]
        Framing[Framing & Whitepapers<br/>INTRO_EVT]
        CommitteeBriefing[Committee Briefings<br/>COMM_EVT]
        LegislativeLang[Legislative Language<br/>COMM_EVT]
    end
    
    subgraph ExecutionLayer["üöÄ Execution Layer - PHASE 2 COMPLETE"]
        ExecutionAgent[execution_outreach_comm_evt.py<br/>‚úÖ IMPLEMENTED & EXECUTED]
        ChannelRegistry[Channel Registry<br/>EMAIL ‚úÖ<br/>PHONE ‚è≥<br/>SMS ‚è≥]
        ApprovalManager[Approval Manager<br/>HR_LANG Integration ‚úÖ]
        ExecutionMonitor[Execution Monitor<br/>Activity Logging ‚úÖ]
        ContactManager[Contact Manager<br/>JSON Storage ‚úÖ]
        EmailProvider[Email Provider<br/>Dry-Run Mode ‚úÖ]
    end
    
    subgraph DataFlow["üì• Data Flow"]
        Artifacts[Artifacts Directory<br/>Stakeholder Maps<br/>Briefing Packets]
        ExecutionOutputs[Execution Outputs<br/>approval-queue.json<br/>activity-log.jsonl<br/>dry-run-log.jsonl<br/>contacts.json]
    end
    
    subgraph Phase3Future["üîÆ Phase 3: Future Components"]
        PhoneSMS[Phone/SMS Providers<br/>‚è≥ Not Yet Implemented]
        CoalitionAgent[Coalition Activation<br/>‚è≥ Not Yet Implemented]
        MediaAgent[Media Seeding<br/>‚è≥ Not Yet Implemented]
        Dashboard[Execution Dashboard<br/>‚è≥ Not Yet Implemented]
        APIRoutes[API Routes<br/>‚è≥ Not Yet Implemented]
    end
    
    %% Core System Flow
    FastAPI --> StateMachine
    StateMachine --> ReviewGates
    
    %% Intelligence to Drafting
    SignalScan --> StakeholderMap
    StakeholderMap --> ConceptMemo
    OppositionDetect --> Framing
    
    %% Drafting to Execution
    CommitteeBriefing --> ExecutionAgent
    StakeholderMap --> ExecutionAgent
    
    %% Execution Layer Internal
    ExecutionAgent --> ChannelRegistry
    ExecutionAgent --> ApprovalManager
    ExecutionAgent --> ExecutionMonitor
    ExecutionAgent --> ContactManager
    ChannelRegistry --> EmailProvider
    ApprovalManager --> ReviewGates
    
    %% Data Flow
    Artifacts --> ExecutionAgent
    ExecutionAgent --> ExecutionOutputs
    
    %% Future Connections
    ExecutionAgent -.->|Future| PhoneSMS
    ExecutionAgent -.->|Future| CoalitionAgent
    ExecutionAgent -.->|Future| MediaAgent
    ExecutionOutputs -.->|Future| Dashboard
    FastAPI -.->|Future| APIRoutes
    
    %% Styling
    style ExecutionLayer fill:#d4edda,stroke:#28a745,stroke-width:3px
    style ExecutionAgent fill:#90ee90,stroke:#006400,stroke-width:2px
    style EmailProvider fill:#90ee90,stroke:#006400,stroke-width:2px
    style ApprovalManager fill:#90ee90,stroke:#006400,stroke-width:2px
    style ExecutionMonitor fill:#90ee90,stroke:#006400,stroke-width:2px
    style ContactManager fill:#90ee90,stroke:#006400,stroke-width:2px
    style Phase3Future fill:#fff3cd,stroke:#ffc107,stroke-width:2px,stroke-dasharray: 5 5
    style OrchestratorCore fill:#e1f5ff,stroke:#0066cc,stroke-width:2px
    style IntelligenceLayer fill:#f0f8ff,stroke:#4682b4,stroke-width:2px
    style DraftingLayer fill:#fff5ee,stroke:#cd853f,stroke-width:2px
